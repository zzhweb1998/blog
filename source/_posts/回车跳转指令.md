---
title: 回车跳转指令
date: 2020-10-24 16:17:12
tags: ["vue","element ui"]
top_img: /img/回车跳转指令/1.PNG
cover: /img/回车跳转指令/1.PNG
categories: 练习笔记
copyright: false
---
# 前言
最近开发项目提出了个特别的需求，使用回车键跳转表单，即用户在表单填写数据的时候按回车键进行跳转下一项继续填写，一看到需求我就觉得好好的tab键不香吗，非要用enter，当时一下子需求解决方案就来了，直接把enter替换成tab的功能不就行了，然而做起来才发现自己的想法多么天真，enter实现tab的功能远没有想象的那么容易，替换是不可能的了，然后网上疯狂找解决方案，最终也就只有操作document节点才能实现出来，由于还用到第三方组件库和甲方的组件等，最终调试了很久才解决，以下是我简单优化后的回车跳转指令的实现，由于用到的vue-cli2+element-ui构建的项目，以这为基础实现element表单的回车跳转指令。
# 原理
在el-form上绑定指令：v-enter-to-next="'(el-form的ref名)'"，通过绑定指令拿到el-form的子节点的值，然后循环给每个子节点绑定回车事件：
```
Vue.directive('enterToNext', {
  bind: function (el, binding, vnode) {
    let element = vnode.elm.elements
    for (let i = 0; i < element.length; i++) {
      element[i].addEventListener('keyup', (ev) => {
        if (ev.keyCode === 13) {
	//回车事件
        }
      }
    }
   }
}
```
根据子节点的type类型做出相应的操作，也有一些需要特殊处理的子节点的操作，以下代码只对一些用的子节点做了处理，如：输入框（text）、选择框（select）、数字输入框（number）、多文本框（textarea）、单选框（radio）、多选框（checkbox）：
```
          let index = i
          if (element[index].type == "text") {
            //如果是下拉选择框则需要添加相同的name和ref
            if (element[index].name == "select") {
              setTimeout(() => {
                //vnode.context相当于this
                vnode.context.$refs[element[index].name].blur()
              }, 100);
            }
            while (element[index].disabled) {
              index++
            }
            element[index+1].focus()
          }

          if (element[index].type == "textarea" || element[index].type == "number") {
            while (element[index].disabled) {
              index++
            }
            element[index+1].focus()
          }

          if (element[index].type == "radio" || element[index].type == "checkbox") {
            while (element[index].disabled) {
              index++
            }
            console.log(element[index]);
            if(element[index+1]&& typeof element[index+1].focus==='function'){
              if(element[index].type == "radio"){
                element[index].previousElementSibling.style.borderColor = ""
              }
              if(element[index+1].type == "radio"){
                element[index+1].previousElementSibling.style.borderColor = "#409EFF"
              }
              element[index+1].focus()
              element[index+1].select()
            }else if(!element[index+1]){
              element[index+1].blur()
            }
          }
```

# 完整代码
1. 指令代码
```
import Vue from 'vue'

//回车跳转(在el-form上绑定指令：v-enter-to-next="'(el-form的ref名)'")
Vue.directive('enterToNext', {
  bind: function (el, binding, vnode) {
    let element = vnode.elm.elements
    for (let i = 0; i < element.length; i++) {
      element[i].addEventListener('keyup', (ev) => {
        if (ev.keyCode === 13) {
          let index = i
          if (element[index].type == "text") {
            //如果是下拉选择框则需要添加相同的name和ref
            if (element[index].name == "select") {
              setTimeout(() => {
                //vnode.context相当于this
                vnode.context.$refs[element[index].name].blur()
              }, 100);
            }
            while (element[index].disabled) {
              index++
            }
            element[index+1].focus()
          }

          if (element[index].type == "textarea" || element[index].type == "number") {
            while (element[index].disabled) {
              index++
            }
            element[index+1].focus()
          }

          if (element[index].type == "radio" || element[index].type == "checkbox") {
            while (element[index].disabled) {
              index++
            }
            console.log(element[index]);
            if(element[index+1]&& typeof element[index+1].focus==='function'){
              if(element[index].type == "radio"){
                element[index].previousElementSibling.style.borderColor = ""
              }
              if(element[index+1].type == "radio"){
                element[index+1].previousElementSibling.style.borderColor = "#409EFF"
              }
              element[index+1].focus()
              element[index+1].select()
            }else if(!element[index+1]){
              element[index+1].blur()
            }
          }
        }
      })
    }
  }
})
```
2. form表单代码
```
<template>
  <div id="enterForm">
    <p style="margin-bottom:30px">回车跳转表单</p>
    <el-form ref="form" :model="form" label-width="80px" v-enter-to-next="'form'">
      <el-form-item label="活动名称">
        <el-input v-model="form.name"></el-input>
      </el-form-item>
      <el-form-item label="活动区域">
        <el-select
          v-model="form.region"
          placeholder="请选择活动区域"
          name="select"
          ref="select"
          :filterable="true"
        >
          <el-option label="区域一" value="shanghai"></el-option>
          <el-option label="区域二" value="beijing"></el-option>
        </el-select>
      </el-form-item>
      <el-form-item label="活动性质">
        <el-checkbox-group v-model="form.type">
          <el-checkbox label="美食/餐厅线上活动" name="type"></el-checkbox>
          <el-checkbox label="地推活动" name="type"></el-checkbox>
          <el-checkbox label="线下主题活动" name="type"></el-checkbox>
          <el-checkbox label="单纯品牌曝光" name="type"></el-checkbox>
        </el-checkbox-group>
      </el-form-item>
      <el-form-item label="特殊资源">
        <el-radio-group v-model="form.resource">
          <el-radio label="线上品牌商赞助"></el-radio>
          <el-radio label="线下场地免费"></el-radio>
        </el-radio-group>
      </el-form-item>
      <el-form-item label="活动形式">
        <el-input type="textarea" v-model="form.desc"></el-input>
      </el-form-item>
      <el-form-item label="活动人数">
        <el-input type="number" v-model="form.desc"></el-input>
      </el-form-item>
      <el-form-item label="活动留言">
        <el-input type="textarea" v-model="form.desc"></el-input>
      </el-form-item>
      <el-form-item>
        <el-button type="primary" @click="onSubmit">立即创建</el-button>
        <el-button>取消</el-button>
      </el-form-item>
    </el-form>
  </div>
</template>

<script>
export default {
  data() {
    return {
      form: {
        name: "",
        region: "",
        date1: "",
        date2: "",
        delivery: false,
        type: [],
        resource: "",
        desc: "",
      },
    };
  },
  created() {
    console.log(this);
  },
  methods: {
    onSubmit() {
      console.log("submit!");
    },
  },
};
</script>

<style lang="less" scoped>
#enterForm {
  width: 600px;
  margin: 10px auto;
}
</style>
```

