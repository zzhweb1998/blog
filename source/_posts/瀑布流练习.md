---
title: 瀑布流练习
date: 2020-04-12 13:14:32
tags: 瀑布流布局
top_img: /img/Waterfall/Waterfall2.PNG
cover: /img/Waterfall/Waterfall2.PNG
categories: 练习笔记
copyright: false
---

## 简介
最近看到一些新闻网站或者展示图片的网站，发现它们的图片或块级元素明明高度大小都不同，但是却能自动地适应，排成一行一行地展示，并且下拉到底的时候，加载新的也会自动适应，个人觉得好奇，就查找了下其中的原理，发现这种方式是瀑布流，于是对瀑布流展开练习与理解。
![](/img/Waterfall/Waterfall.PNG)

## 实现原理
要做到块级元素都根据上面的高度自动适应排列，那么我们就不能单纯地靠html+css布局了，需要用到js来帮助计算位置。
首先，我先弄一些div的.box元素，并赋予一样的宽度和随机的高度，让它们都左浮动，得到如下图片。
![](/img/Waterfall/Waterfall1.PNG)
```
- html
    <div class="container">
        <div class="box">100px</div>
        <div class="box">120px</div>
        <div class="box">80px</div>
        <div class="box">160px</div>
        <div class="box">60px</div>
        <div class="box">30px</div>
        <div class="box">150px</div>
        <div class="box">200px</div>
        <div class="box">130px</div>
        <div class="box">110px</div>
        <div class="box">50px</div>
        <div class="box">130px</div>
    </div>
- css
        .container {
            position: relative;
            width: 1200px;
            height: auto;
            margin: 30px auto;
            height: 1000px;
        }

        .container .box {
            box-sizing: border-box;
            float: left;
            width: 400px;
            border: 1px solid #aaa;
            text-align: center;
        }
- js
        var box = document.getElementsByClassName("box")
        for (let i = 0; i < box.length; i++) {
            box[i].style.height = box[i].innerHTML
        }
```
现在，需要让除第一排的.box元素外，其它.box元素自动地适应，排成一行一行地展示，首先获取.box元素的宽度和包裹.box元素的父元素的宽度，通过父元素/.box元素得到展示的列数cols。
```
        var boxWidth = box[0].offsetWidth //所有box一致宽度取第一个的宽度
        var containerWidth = document.getElementsByClassName("container")[0].offsetWidth //container的宽度
        //求列数
        var cols = parseInt(containerWidth / boxWidth)
```
再定义heightArr数组存储每一列的高度，循环把第一排的.box元素的高度对应存储在heightArr数组里，在循环heightArr数组，取出其中最小的高度minBoxHeight和对应的索引号minIndex，再通过js把第一排外的.box元素添加样式，使第一排以外下一个.box在索引号minIndex对应的列排列下去，最后把.box的高度加在heightArr最小列上。
```
//创建存放高度值的数组
        var heightArr = []
        //box遍历循环，除第一排不需要定位，取高度值做定位处理
        for (let index = 0; index < box.length; index++) {
            //取出box高度
            var boxHeight = box[index].offsetHeight
            if (index < cols) { //如果是第一排
                heightArr[index] = boxHeight //把第一排的列的高度存入heightArr
            } else {
                //取出heightArr最小的高度值
                var minBoxHeight = Math.min(...heightArr)
                //最小的索引
                var minIndex
                heightArr.forEach((el, index) => {
                    if (el == minBoxHeight) {
                        minIndex = index
                    }
                });
                //把当前box在最小第一列最小的box后排列
                box[index].style.position = "absolute"
                box[index].style.top = minBoxHeight+"px"
                box[index].style.left = (minIndex * boxWidth)+"px"
                //最后把当前box的高度加在heightArr最小列上
                heightArr[minIndex] += box[index].offsetHeight
            }
        }
```
## 完整代码
图片展示
![](/img/Waterfall/Waterfall2.PNG)
```
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        .container {
            position: relative;
            width: 1200px;
            height: auto;
            margin: 30px auto;
            height: 1000px;
        }

        .container .box {
            box-sizing: border-box;
            float: left;
            width: 400px;
            border: 1px solid #aaa;
            text-align: center;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="box">100px</div>
        <div class="box">120px</div>
        <div class="box">80px</div>
        <div class="box">160px</div>
        <div class="box">60px</div>
        <div class="box">30px</div>
        <div class="box">150px</div>
        <div class="box">200px</div>
        <div class="box">130px</div>
        <div class="box">110px</div>
        <div class="box">50px</div>
        <div class="box">130px</div>
    </div>
</body>

<script>
    window.onload = function () {
        var box = document.getElementsByClassName("box")
        for (let i = 0; i < box.length; i++) {
            box[i].style.height = box[i].innerHTML
        }
        var boxWidth = box[0].offsetWidth //所有box一致宽度
        var containerWidth = document.getElementsByClassName("container")[0].offsetWidth //container的宽度
        //求列数
        var cols = parseInt(containerWidth / boxWidth)
        //创建存放高度值的数组
        var heightArr = []
        //box遍历循环，除第一排不需要定位，取高度值做定位处理
        for (let index = 0; index < box.length; index++) {
            //取出box高度
            var boxHeight = box[index].offsetHeight
            if (index < cols) { //如果是第一排
                heightArr[index] = boxHeight //把第一排的列的高度存入heightArr
            } else {
                //取出heightArr最小的高度值
                var minBoxHeight = Math.min(...heightArr)
                //最小的索引
                var minIndex
                heightArr.forEach((el, index) => {
                    if (el == minBoxHeight) {
                        minIndex = index
                    }
                });
                //把当前box在最小第一列最小的box后排列
                box[index].style.position = "absolute"
                box[index].style.top = minBoxHeight+"px"
                box[index].style.left = (minIndex * boxWidth)+"px"
                //最后把当前box的高度加在heightArr最小列上
                heightArr[minIndex] += box[index].offsetHeight
            }
        }
</script>

</html>
```

